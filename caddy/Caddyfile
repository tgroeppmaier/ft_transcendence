# Listen on all interfaces on port 80
:80 {
	# Redirect to HTTPS on port 8443, preserving the hostname (IP)
	redir https://{host}:8443{uri} permanent
}

localhost, 192.168.1.103 {
	tls internal

	# Log requests for debugging
	log

	# Handle API requests first
	handle /api/* {
		reverse_proxy backend:3000
	}

	# Handle all other requests
	handle {
		root * /usr/share/caddy
		file_server
		try_files {path} {path}/ /index.html
	}
}
