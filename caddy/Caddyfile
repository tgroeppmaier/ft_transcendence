# HTTP redirect to HTTPS on port 8443
localhost:80 {
	redir https://{host}:8443{uri} permanent
}

# HTTPS server
localhost:443 {
	tls internal

	# Log requests for debugging
	log

	# Handle API requests first. This block is mutually exclusive.
	handle /api/* {
		reverse_proxy backend:3000
	}

	# Handle all other requests by serving the static frontend.
	handle {
		root * /usr/share/caddy
		file_server
		try_files {path} {path}/ /index.html
	}
}
